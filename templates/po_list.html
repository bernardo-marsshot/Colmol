
{% extends "base.html" %}
{% block content %}
<h1>Encomendas a Fornecedores (POs)</h1>
<div class="card p-3 mt-3">
  <table class="table table-hover">
    <thead><tr><th>PO</th><th>Fornecedor</th><th>Linhas</th><th>Guias Recebidas</th></tr></thead>
    <tbody>
      {% for p in pos %}
      <tr>
        <td><strong>{{ p.number }}</strong></td>
        <td>{{ p.supplier.name }}</td>
        <td>
          <ul class="mb-0">
          {% for l in p.lines.all %}
            <li>{{ l.internal_sku }} — pedida {{ l.qty_ordered }} ± {{ l.tolerance }}</li>
          {% endfor %}
          </ul>
        </td>
        <td>
          {% with guias=p.inbound_docs.all %}
            {% if guias %}
              <ul class="mb-0">
              {% for guia in guias %}
                <li>
                  <a href="/inbound/{{ guia.id }}/" class="text-decoration-none">
                    {{ guia.get_doc_type_display }} {{ guia.number }}
                  </a>
                  <small class="text-muted">({{ guia.received_at|date:"d/m/Y H:i" }})</small>
                  {% if guia.match_result %}
                    {% if guia.match_result.status == 'matched' %}
                      <span class="badge bg-success">✓</span>
                    {% elif guia.match_result.status == 'exceptions' %}
                      <span class="badge bg-warning">!</span>
                    {% endif %}
                  {% endif %}
                </li>
              {% endfor %}
              </ul>
            {% else %}
              <small class="text-muted">Nenhuma guia recebida</small>
            {% endif %}
          {% endwith %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4">Sem POs. Use o admin para criar dados de exemplo.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
