
{% extends "base.html" %}
{% block content %}
<h1>Encomendas a Fornecedores (POs)</h1>
<div class="card p-3 mt-3">
  <table class="table table-hover">
    <thead><tr><th>PO</th><th>Fornecedor</th><th>Linhas</th><th>Guias Recebidas</th></tr></thead>
    <tbody>
      {% for p in pos %}
      <tr>
        <td>
          <strong>{{ p.number }}</strong>
          {% if p.is_complete %}
            <span class="badge bg-success">✓</span>
          {% endif %}
        </td>
        <td>{{ p.supplier.name }}</td>
        <td>
          <ul class="mb-0">
          {% for l in p.lines.all %}
            <li>
              {{ l.internal_sku }} — pedida {{ l.qty_ordered|floatformat:2 }} ± {{ l.tolerance|floatformat:2 }}
              {% if l.is_complete %}
                <span class="badge bg-success">✓</span>
              {% endif %}
            </li>
          {% endfor %}
          </ul>
        </td>
        <td>
          {% if p.guias_remessa %}
            <ul class="mb-0">
            {% for guia in p.guias_remessa %}
              <li>
                <a href="/inbound/{{ guia.id }}/" class="text-decoration-none">
                  {{ guia.get_doc_type_display }} {{ guia.number }}
                </a>
                <small class="text-muted">({{ guia.received_at|date:"d/m/Y H:i" }})</small>
                {% if guia.match_result %}
                  {% if guia.match_result.status == 'matched' %}
                    <span class="badge bg-success">✓</span>
                  {% elif guia.match_result.status == 'exceptions' %}
                    <span class="badge bg-warning">!</span>
                  {% endif %}
                {% endif %}
              </li>
            {% endfor %}
            </ul>
          {% else %}
            <small class="text-muted">Nenhuma guia recebida</small>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4">Sem POs. Use o admin para criar dados de exemplo.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
