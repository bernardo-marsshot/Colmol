
{% extends "base.html" %}
{% block content %}
<h1 class="mb-3">Dashboard</h1>
<div class="row g-3">
  <div class="col-md-3"><div class="card p-3"><div>Total Docs</div><h3>{{ total_docs }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Matched</div><h3>{{ matched }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Com Exceções</div><h3>{{ exceptions }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Fornecedores</div><h3>{{ suppliers }}</h3></div></div>
</div>

<div class="row mt-4">
  <div class="col-md-6">
    <div class="card p-3">
      <h5 class="mb-3">Processamento</h5>
      <canvas id="kpiChart" style="max-height: 300px;"></canvas>
    </div>
</div>

<div class="card p-3 mt-4">
  <h5 class="mb-4">Últimos documentos</h5>
  
  {% for d in latest %}
  <div class="row mb-3 align-items-center">
    <div class="col-md-2">
      <small class="text-muted">{{ d.received_at|date:"d/m H:i" }}</small>
    </div>
    <div class="col-md-3">
      <span class="text-muted">{{ d.supplier.name }}</span>
    </div>
    <div class="col-md-4">
      <a href="{% url 'inbound_detail' d.pk %}" class="btn-bizneo-document">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ d.get_doc_type_display }} {{ d.number }}
      </a>
    </div>
    <div class="col-md-2">
      {% if d.po %}
        <small class="text-muted">PO: {{ d.po.number }}</small>
      {% else %}
        <small class="text-muted">-</small>
      {% endif %}
    </div>
    <div class="col-md-1">
      {% if d.match_result %}
        {% if d.match_result.status == 'matched' %}
          <span class="badge bg-success">✓</span>
        {% else %}
          <span class="badge bg-warning">!</span>
        {% endif %}
      {% else %}
        <span class="badge bg-secondary">-</span>
      {% endif %}
    </div>
  </div>
  {% empty %}
  <div class="text-center py-4">
    <p class="text-muted mb-0">Sem documentos ainda.</p>
  </div>
  {% endfor %}
</div>

<script>
const ctx = document.getElementById('kpiChart');
new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['Matched','Exceções','Por processar'],
    datasets: [{ 
      data: [{{ matched }}, {{ exceptions }}, {{ total_docs }} - {{ matched }} - {{ exceptions }}],
      backgroundColor: [
        '#FF6B35',  // Laranja do cliente para documentos matched
        '#DC3545',  // Vermelho para exceções
        '#F8F9FA'   // Cinza muito claro para documentos por processar
      ],
      borderColor: [
        '#FF6B35',
        '#DC3545', 
        '#F8F9FA'
      ],
      borderWidth: 2
    }]
  },
  options: { 
    responsive: true,
    plugins: {
      legend: {
        labels: {
          color: '#000000',  // Texto preto para as legendas
          font: {
            size: 14,
            weight: 'normal'
          },
          usePointStyle: true
        }
      }
    },
    elements: {
      arc: {
        borderWidth: 3
      }
    }
  }
});
</script>
{% endblock %}
