
{% extends "base.html" %}
{% block content %}
<h1 class="mb-3">Dashboard</h1>
<div class="row g-3">
  <div class="col-md-3"><div class="card p-3"><div>Total Docs</div><h3>{{ total_docs }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Matched</div><h3>{{ matched }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Com Exceções</div><h3>{{ exceptions }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Fornecedores</div><h3>{{ suppliers }}</h3></div></div>
</div>

<div class="row mt-4">
  <div class="col-md-6">
    <div class="card p-3">
      <h5 class="mb-3">Processamento</h5>
      <canvas id="kpiChart" style="max-height: 300px;"></canvas>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card p-3">
      <h5 class="mb-3">Ações Rápidas</h5>
      <div class="d-grid gap-3">
        <a href="/upload/" class="btn-bizneo-primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="7,10 12,15 17,10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Carregar Novo Documento
        </a>
        <a href="/admin/" class="btn-bizneo-success">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            <path d="m12 1 1.5 1.5L16 1l1.5 1.5L20 1v2.5L18.5 5 20 6.5V9h-2.5L16 7.5 14.5 9H12V6.5L13.5 5 12 3.5 10.5 5 12 6.5V9H9.5L8 7.5 6.5 9H4V6.5L5.5 5 4 3.5V1l2.5 1.5L8 1l1.5 1.5L12 1Z" stroke="currentColor" stroke-width="2"/>
          </svg>
          Administração
        </a>
        <a href="/po/" class="btn-bizneo-secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Encomendas (POs)
        </a>
      </div>
    </div>
  </div>
</div>

<div class="card p-3 mt-4">
  <h5>Últimos documentos</h5>
  <table class="table table-hover align-middle">
    <thead><tr><th>Data</th><th>Fornecedor</th><th>Doc</th><th>PO</th><th>Estado</th></tr></thead>
    <tbody>
    {% for d in latest %}
      <tr>
        <td>{{ d.received_at|date:"Y-m-d H:i" }}</td>
        <td>{{ d.supplier.name }}</td>
        <td><a href="{% url 'inbound_detail' d.pk %}">{{ d.get_doc_type_display }} {{ d.number }}</a></td>
        <td>{% if d.po %}{{ d.po.number }}{% else %}-{% endif %}</td>
        <td>{% if d.match_result %}{{ d.match_result.status }}{% else %}-{% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="5" class="text-center">Sem documentos ainda.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<script>
const ctx = document.getElementById('kpiChart');
new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['Matched','Exceções','Por processar'],
    datasets: [{ 
      data: [{{ matched }}, {{ exceptions }}, {{ total_docs }} - {{ matched }} - {{ exceptions }}],
      backgroundColor: [
        '#FF6B35',  // Laranja do cliente para documentos matched
        '#DC3545',  // Vermelho para exceções
        '#F8F9FA'   // Cinza muito claro para documentos por processar
      ],
      borderColor: [
        '#FF6B35',
        '#DC3545', 
        '#F8F9FA'
      ],
      borderWidth: 2
    }]
  },
  options: { 
    responsive: true,
    plugins: {
      legend: {
        labels: {
          color: '#000000',  // Texto preto para as legendas
          font: {
            size: 14,
            weight: 'normal'
          },
          usePointStyle: true
        }
      }
    },
    elements: {
      arc: {
        borderWidth: 3
      }
    }
  }
});
</script>
{% endblock %}
