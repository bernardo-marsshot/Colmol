
{% extends "base.html" %}
{% block content %}
<h1 class="mb-3">Dashboard</h1>
<div class="row g-3">
  <div class="col-md-3"><div class="card p-3"><div>Total Docs</div><h3>{{ total_docs }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Matched</div><h3>{{ matched }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Com Exceções</div><h3>{{ exceptions }}</h3></div></div>
  <div class="col-md-3"><div class="card p-3"><div>Fornecedores</div><h3>{{ suppliers }}</h3></div></div>
</div>

<div class="row mt-4">
  <div class="col-md-6">
    <div class="card p-3">
      <h5 class="mb-3">Processamento</h5>
      <canvas id="kpiChart" style="max-height: 300px;"></canvas>
    </div>
  </div>
</div>

<div class="card p-3 mt-4">
  <h5>Últimos documentos</h5>
  <table class="table table-hover align-middle">
    <thead><tr><th>Data</th><th>Fornecedor</th><th>Doc</th><th>PO</th><th>Estado</th></tr></thead>
    <tbody>
    {% for d in latest %}
      <tr>
        <td>{{ d.received_at|date:"Y-m-d H:i" }}</td>
        <td>{{ d.supplier.name }}</td>
        <td><a href="{% url 'inbound_detail' d.pk %}">{{ d.get_doc_type_display }} {{ d.number }}</a></td>
        <td>{% if d.po %}{{ d.po.number }}{% else %}-{% endif %}</td>
        <td>{% if d.match_result %}{{ d.match_result.status }}{% else %}-{% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="5" class="text-center">Sem documentos ainda.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<script>
const ctx = document.getElementById('kpiChart');
new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['Matched','Exceções','Por processar'],
    datasets: [{ 
      data: [{{ matched }}, {{ exceptions }}, {{ total_docs|add:'-0' }} - ({{ matched }} + {{ exceptions }}) ],
      backgroundColor: [
        '#FF6B35',  // Laranja do cliente para documentos matched
        '#DC3545',  // Vermelho para exceções
        '#F8F9FA'   // Cinza muito claro para documentos por processar
      ],
      borderColor: [
        '#FF6B35',
        '#DC3545', 
        '#F8F9FA'
      ],
      borderWidth: 2
    }]
  },
  options: { 
    responsive: true,
    plugins: {
      legend: {
        labels: {
          color: '#000000',  // Texto preto para as legendas
          font: {
            size: 14,
            weight: 'normal'
          },
          usePointStyle: true
        }
      }
    },
    elements: {
      arc: {
        borderWidth: 3
      }
    }
  }
});
</script>
{% endblock %}
